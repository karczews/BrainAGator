#!/bin/sh
# Pre-commit hook to run ktlint format
# This hook automatically formats Kotlin files before committing

echo "Running ktlint format..."

./gradlew ktlintFormat --quiet

# Check if ktlintFormat succeeded
if [ $? -ne 0 ]; then
    echo "❌ ktlint format failed. Please fix the issues above and try again."
    exit 1
fi

# Check if any Kotlin files were modified by ktlintFormat
STAGED_FILES=$(git diff --name-only --diff-filter=M | grep -E '\.(kt|kts)$' || true)

if [ -n "$STAGED_FILES" ]; then
    echo "✅ ktlint format applied changes to:"
    echo "$STAGED_FILES"
    echo ""
    echo "⚠️  Please review the changes and stage them manually with:"
    echo "   git add <files>"
    echo ""
    echo "Then commit again."
    exit 1
fi

echo "✅ ktlint format complete."
exit 0
